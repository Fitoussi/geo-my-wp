var GMW_Extensions={processing:!1,set_processing:function(status,reload){status?(jQuery("#gmw-extensions-page .disabler-block").show(),jQuery("#gmw-admin-page-loader").fadeIn("fast")):reload?setTimeout((function(){location.reload()}),1500):setTimeout((function(){jQuery("#gmw-extensions-page .disabler-block").hide(),jQuery("#gmw-admin-page-loader").fadeOut("fast",(function(){jQuery(this).find("span").html(""),jQuery("#gmw-extensions-page .gmw-extension-wrapper").removeClass("gmw-processing-action")}))}),2500),GMW_Extensions.processing=status},init:function(){jQuery(".extensions-wrapper").find(".gmw-extension-wrapper.premium.inactive").sort().appendTo(jQuery(".extensions-wrapper")),jQuery(".gmw-tooltip").hover((function(){jQuery(this).addClass("active")}),(function(){jQuery(this).removeClass("active")})),GMW_Extensions.tabs_init(),jQuery(".gmw-license-wrapper").each((function(){jQuery(this).find(".gmw-license-key").length||jQuery(this).closest(".gmw-extension-wrapper").addClass("disabled")})),jQuery(document).on("click",".extensions-updater-button",(function(e){e.preventDefault(),GMW_Extensions.set_processing(!0,!1),GMW_Extensions.extensions_updater(jQuery(this))})),jQuery(document).on("click",".gmw-extension-action-button:not( .get-extension )",(function(e){if(e.preventDefault(),jQuery(this).closest(".gmw-extension-wrapper").hasClass("disabled"))return!1;jQuery(this).closest(".gmw-extension-wrapper").addClass("gmw-processing-action"),GMW_Extensions.set_processing(!0,!1),GMW_Extensions.extension_activation(jQuery(this),!1)})),jQuery(document).on("click",".gmw-license-action-button",(function(e){e.preventDefault(),jQuery(this).closest(".gmw-extension-wrapper").addClass("gmw-processing-action"),GMW_Extensions.set_processing(!0,!1),GMW_Extensions.license_key_actions(jQuery(this))})),jQuery(document).on("keyup change",".gmw-extension-bottom .gmw-license-key",(function(e){var thisToggle=jQuery(this).closest(".field-wrapper").find(".gmw-atb-toggle");0===jQuery(this).val().length?thisToggle.fadeOut("fast"):thisToggle.fadeIn("fast")})),jQuery(".gmw-extension-bottom").find(".gmw-license-key").trigger("change")},tabs_init:function(){jQuery("#gmw-extensions-tabs-wrapper span").on("click",(function(){var tab=jQuery(this).data("type");if(jQuery(".gmw-extensions-wrapper, #gmw-extensions-tabs-wrapper span").removeClass("active"),"all"==tab?jQuery(".gmw-extensions-wrapper").addClass("active"):jQuery(".gmw-extensions-wrapper."+tab).addClass("active"),history.pushState){var newurl=window.location.protocol+"//"+window.location.host+window.location.pathname+"?page=gmw-extensions&tab="+tab;window.history.pushState({path:newurl},"",newurl)}jQuery(this).addClass("active")})),jQuery("#gmw-extensions-status-filter").change((function(e){e.preventDefault();var extensions=jQuery("#gmw-extensions-filter").val(),status=jQuery("#gmw-extensions-status-filter").val(),thisClass="";jQuery(".gmw-admin-page-content-inner .gmw-extension-wrapper").hide(),""==status?jQuery(".gmw-admin-page-content-inner .gmw-extension-wrapper").show():jQuery(".gmw-admin-page-content-inner .gmw-extension-wrapper."+status).show()}))},extensions_updater:function(actionButton){actionButton.addClass("updating-message"),jQuery.ajax({type:"POST",dataType:"json",url:gmwVars.ajaxUrl,data:{action:"gmw_extensions_updater",updater_action:actionButton.attr("data-action"),security:actionButton.attr("data-nonce")},success:function(response){actionButton.toggleClass("updating-message updated-message"),setTimeout((function(){actionButton.removeClass("updated-message").fadeOut("fast",(function(){"updater_enabled"==response?(actionButton.toggleClass("button-primary button-secondary").attr("data-action","disable").html("Disable Updater").fadeIn("fast"),actionButton.closest(".extensions-updater").toggleClass("disabled enabled")):(actionButton.toggleClass("button-secondary button-primary").attr("data-action","enable").html("Enable Updater").fadeIn("fast"),actionButton.closest(".extensions-updater").toggleClass("enabled disabled"))}))}),1500)}}).fail((function(jqXHR,textStatus,error){window.console&&window.console.log&&(console.log(textStatus+": "+error),jqXHR.responseText&&console.log(jqXHR.responseText)),orgHtml=actionButton.html(),orgClass=actionButton.attr("class"),actionButton.fadeOut("fast",(function(){actionButton.html("Action failed").removeClass("updating-message button-primary").addClass("gmw-icon-cancel button-secondary").fadeIn("fast")})),setTimeout((function(){actionButton.fadeOut("fast",(function(){actionButton.html(orgHtml).attr("class",orgClass).removeClass("updating-message").fadeIn("fast")}))}),1500),GMW_Extensions.set_processing(!1,!1)})).done((function(response){GMW_Extensions.set_processing(!1,!1)}))},extension_activation:function(actionLink){actionLink.addClass("updating-message").find(".gmw-atb-label").html(actionLink.data("updating_message")),jQuery("#gmw-admin-page-loader span").html(actionLink.data("updating_message")+" extension..."),actionLinkWrap=actionLink.closest(".gmw-extension-wrapper"),licenseData=actionLink.data(),jQuery.ajax({type:"GET",dataType:"json",url:gmwVars.ajaxUrl,data:{action:"gmw_"+licenseData.action,gmw_action:licenseData.action,slug:licenseData.slug,basename:licenseData.basename,security:licenseData.nonce},success:function(response){newLink=response.newLink,actionLink.toggleClass("updating-message updated-message").find(".gmw-atb-label").html(actionLink.data("updated_message")),jQuery("#gmw-admin-page-loader span").html("Extension "+actionLink.data("updated_message")),setTimeout((function(){actionLink.closest(".gmw-extension-wrapper.active, .gmw-extension-wrapper.inactive").toggleClass("active inactive").removeClass("disabled"),actionLink.fadeOut("fast",(function(){jQuery(this).replaceWith(newLink)})),jQuery.each(response.dependends,(function(slug,message){"activate_extension"==licenseData.action?jQuery('.gmw-extension-wrapper[data-slug="'+slug+'"]').removeClass("disabled"):jQuery('.gmw-extension-wrapper[data-slug="'+slug+'"]').removeClass("active").addClass("inactive disabled").find(".activation-disabled-message p span").html(message)}))}),1500)}}).fail((function(jqXHR,textStatus,error){window.console&&window.console.log&&(console.log(textStatus+": "+error),jqXHR.responseText&&console.log(jqXHR.responseText)),actionLink.removeClass("updating-message").addClass("updated-message failed-message").find(".gmw-atb-label").html(actionLink.data("failed_message")),jQuery("#gmw-admin-page-loader span").html(actionLink.data("failed_message")),setTimeout((function(){actionLink.removeClass("updated-message").removeClass("failed-message").find(".gmw-atb-label").html(actionLink.data("label"))}),2e3),GMW_Extensions.set_processing(!1,!1)})).done((function(response){var reload=!1;GMW_Extensions.set_processing(!1,!1)}))},license_key_actions:function(actionButton){licenseWrap=actionButton.closest(".gmw-license-wrapper"),actionMessageWrap=licenseWrap.find(".actions-message"),license_data=actionButton.data(),license_data.license_key=licenseWrap.find(".gmw-license-key").val(),license_data.license_key?(actionButton.addClass("updating-message").find(".gmw-atb-label").html(actionButton.data("updating_message")),jQuery("#gmw-admin-page-loader span").html(actionButton.data("updating_message")+"...")):(actionMessageWrap.addClass("updating-message").html("Removing license key").show().css("display","inline-flex"),jQuery("#gmw-admin-page-loader span").html("Removing license key...")),jQuery.ajax({type:"POST",dataType:"json",url:gmwVars.ajaxUrl,data:{action:"gmw_license_key_actions",data:license_data,security:license_data.nonce},success:function(response){newLicenseWrap=response.form,licenseData=response.license_data,"activate_license"==license_data.action?"blank_key"!=licenseData.remote_connection&&("valid"==licenseData.license?(actionButton.toggleClass("updating-message updated-message").find(".gmw-atb-label").html(actionButton.data("updated_message")),jQuery("#gmw-admin-page-loader span").html(actionButton.data("updated_message"))):(actionButton.toggleClass("updating-message updated-message failed-message").find(".gmw-atb-label").html(actionButton.data("failed_message")),jQuery("#gmw-admin-page-loader span").html(actionButton.data("failed_message")))):(actionButton.toggleClass("updating-message updated-message").find(".gmw-atb-label").html(actionButton.data("updated_message")),jQuery("#gmw-admin-page-loader span").html(actionButton.data("updated_message"))),setTimeout((function(){licenseWrap.hide(),newLicenseWrap=jQuery(newLicenseWrap).hide(),licenseWrap.replaceWith(newLicenseWrap),newLicenseWrap.show(),"valid"==response.license_data.license||"invalid"==response.license_data.license&&"expired"==response.license_data.error?newLicenseWrap.closest(".gmw-extension-wrapper").removeClass("disabled"):"deactivated"!=response.license_data.license&&"invalid"!=response.license_data.license||newLicenseWrap.closest(".gmw-extension-wrapper").addClass("disabled").find(".activation-disabled-message").remove()}),2e3)}}).fail((function(jqXHR,textStatus,error){window.console&&window.console.log&&(console.log(textStatus+": "+error),jqXHR.responseText&&console.log(jqXHR.responseText)),actionButton.removeClass("updating-message").addClass("updated-message failed-message").find(".gmw-atb-label").html(actionButton.data("failed_message")),jQuery("#gmw-admin-page-loader span").html(actionButton.data("failed_message")),setTimeout((function(){actionButton.removeClass("updated-message").removeClass("failed-message").find(".gmw-atb-label").html(actionButton.data("label"))}),2e3),GMW_Extensions.set_processing(!1,!1)})).done((function(response){GMW_Extensions.set_processing(!1,!1)}))}};jQuery(document).ready((function(){GMW_Extensions.init()}));