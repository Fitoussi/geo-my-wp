var GMW_Maps={},GMW_Map=function(o,e,i){this.id=o.map_id,this.prefix=o.prefix,this.settings=o,this.gmw_form=i||!1,this.wrap_element=jQuery("#gmw-map-wrapper-"+this.id),this.map_element="gmw-map-"+this.id,this.options=e||{zoom:8,mapTypeId:"ROADMAP"},this.map=!1,this.locations=[],this.previous_locations=[],this.markers=[],this.active_info_window=null,this.user_location=!1,this.user_position=!1,this.user_info_window=!1,this.clusters_path=o.clusters_path||this.default_cluster_path,this.grouping_type=o.group_markers||"standard",this.info_window_type=o.info_window_type||"standard",this.info_window_ajax=o.info_window_ajax||!1,this.info_window_template=o.info_window_template||"default",this.user_marker=!1,this.clusters=!1,this.bounds=!1,this.active_marker=null,this.polylines=[],this.auto_zoom_level=!1,this.zoom_position=!1,this.init()};GMW_Map.prototype.default_cluster_path="https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m",GMW_Map.prototype.init=function(){GMW.do_action("gmw_map_init",this)},GMW_Map.prototype.render=function(o,e){var i=this;jQuery("#"+i.map_element).length&&(i.locations=o||i.locations,i.user_location=e||i.user_location,i.bounds=new google.maps.LatLngBounds,"auto"==i.options.zoom?(i.auto_zoom_level=!0,i.options.zoom=13):(i.auto_zoom_level=!1,i.options.zoom=parseInt(i.options.zoom)),i.options.center=new google.maps.LatLng("40.758895","-73.985131"),i.options.mapTypeId=google.maps.MapTypeId[i.options.mapTypeId],i.wrap_element.slideDown("fast",function(){i.map=new google.maps.Map(document.getElementById(i.map_element),i.options),google.maps.event.addListenerOnce(i.map,"idle",function(){if(jQuery("#gmw-map-loader-"+i.id).fadeOut(1e3),i.wrap_element.find(".gmw-map-cover").fadeOut(1e3),i.options.resizeMapControl&&0!=jQuery("#gmw-resize-map-toggle-"+i.id).length){var o=document.getElementById("gmw-resize-map-toggle-"+i.id);o.style.position="absolute",i.map.controls[google.maps.ControlPosition.TOP_RIGHT].push(o),o.style.display="block",jQuery("#gmw-resize-map-toggle-"+i.id).on("click",function(){var o=i.map.getCenter();i.wrap_element.toggleClass("gmw-expanded-map"),jQuery(this).toggleClass("gmw-icon-resize-full").toggleClass("gmw-icon-resize-small"),setTimeout(function(){google.maps.event.trigger(i.map,"resize"),i.map.setCenter(o)},100)})}google.maps.event.addListener(i.map,"click",function(o){i.close_info_window()}),google.maps.event.addDomListener(i.map,"zoom_changed",function(o){i.close_info_window()}),i.render_user_marker(),i.render_markers(i.locations)})}))},GMW_Map.prototype.update=function(o,e){var i=this;return i.locations=o||i.locations,i.user_location=e||i.user_location,i.map===!1?void i.render(i.locations,i.user_location):(i.bounds=new google.maps.LatLngBounds,i.close_info_window(),void i.wrap_element.slideDown("fast",function(){i.clear(),i.clear_user_marker(),i.render_user_marker(),i.render_markers(i.locations)}))},GMW_Map.prototype.clear=function(){for(var o=this,e=0;e<o.markers.length+1;e++)e<o.markers.length?o.markers[e]&&o.markers[e].setMap(null):(this.clear_polylines(),o.markers=[],this.markers_grouping_clear())},GMW_Map.prototype.clear_polylines=function(){for(var o=0;o<this.polylines.length+1;o++)o<this.polylines.length?this.polylines[o].setMap(null):this.polylines=[]},GMW_Map.prototype.markers_grouping_init=function(){"normal"==this.grouping_type&&(this.grouping_type="standard"),GMW.do_action("gmw_markers_grouping_init",this.grouping_type,this);var o=this.grouping_type+"_grouping_init";"function"==typeof this[o]?this[o]():console.log("The function "+o+" not exists.")},GMW_Map.prototype.markers_grouping_clear=function(){GMW.do_action("gmw_markers_grouping_clear",this.grouping_type,this);var o=this.grouping_type+"_grouping_clear";"function"==typeof this[o]?this[o]():console.log("The function "+o+" not exists.")},GMW_Map.prototype.standard_grouping_init=function(){},GMW_Map.prototype.standard_grouping_clear=function(){},GMW_Map.prototype.markers_clusterer_grouping_init=function(){"function"==typeof MarkerClusterer&&(this.clusters=new MarkerClusterer(this.map,this.markers,{imagePath:this.clusters_path,clusterClass:this.prefix+"-cluster cluster",maxZoom:15}))},GMW_Map.prototype.markers_clusterer_grouping_clear=function(){"function"==typeof MarkerClusterer&&0!=this.clusters&&this.clusters.clearMarkers()},GMW_Map.prototype.move_marker=function(){var o=360/this.locations.length,e=this.locations[i].marker_position.lat()+-25e-6*Math.cos(+o*i/180*Math.PI),t=this.locations[i].marker_position.lng()+-25e-6*Math.sin(+o*i/180*Math.PI),n=new google.maps.LatLng(e,t);return this.polylines.push(new google.maps.Polyline({path:[this.locations[i].marker_position,n],strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:this.map})),n},GMW_Map.prototype.render_marker=function(o){var e={position:o.position,icon:o.icon,map:this.map,animation:null,location_id:o.id,iw_content:o.content};return e=GMW.apply_filters("gmw_generate_marker_options",e,o.id,this),new google.maps.Marker(e)},GMW_Map.prototype.render_user_marker=function(){var o=this;if(0!=o.user_location&&0!=o.user_location.lat&&0!=o.user_location.lng&&"0"!=o.user_location.map_icon&&""!=o.user_location.map_icon){o.user_position=new google.maps.LatLng(o.user_location.lat,o.user_location.lng),o.bounds.extend(o.user_position);var e={position:o.user_position,icon:o.user_location.map_icon,id:"user_marker",content:""};o.user_marker=o.render_marker(e),0!=o.user_location.iw_content&&null!=o.user_location.iw_content&&(o.user_marker.iw_content='<span class="title">'+o.user_location.iw_content+"</span>",o.user_info_window=new google.maps.InfoWindow({content:'<div class="gmw-info-window user-marker map-'+this.id+" "+this.prefix+'">'+o.user_marker.iw_content+"</div>",maxHeight:"15px"}),google.maps.event.addListener(o.user_marker,"click",function(){o.user_info_window.open(o.map,o.user_marker)}),1==o.user_location.iw_open&&setTimeout(function(){o.user_info_window.open(o.map,o.user_marker)},500))}},GMW_Map.prototype.clear_user_marker=function(){0!=this.user_marker&&(this.user_marker.setMap(null),this.user_marker=!1,this.user_position=!1)},GMW_Map.prototype.render_markers=function(o){var e=this;e.markers_grouping_init(),e.locations=o;var t=e.locations.length;for(i=0;i<t+1;i++)if(i<t){if(void 0==e.locations[i].lat||void 0==e.locations[i].lng||"0.000000"==e.locations[i].lat||"0.000000"==e.locations[i].lng)continue;e.locations[i].marker_position=new google.maps.LatLng(e.locations[i].lat,e.locations[i].lng),"markers_spiderfier"!=e.grouping_type&&e.bounds.contains(e.locations[i].marker_position)&&(e.locations[i].marker_position=e.move_marker()),e.bounds.extend(e.locations[i].marker_position);var n={position:e.locations[i].marker_position,icon:e.locations[i].map_icon,id:i,content:e.locations[i].info_window_content};e.markers[i]=e.render_marker(n),"markers_clusterer"==e.grouping_type&&"function"==typeof MarkerClusterer?(e.clusters.addMarker(e.markers[i]),google.maps.event.addListener(e.markers[i],"click",function(){e.marker_click(this)})):"markers_spiderfier"==e.grouping_type&&"function"==typeof OverlappingMarkerSpiderfier?(e.spiderfiers.addMarker(e.markers[i]),e.markers[i].setMap(e.map),google.maps.event.addListener(e.markers[i],"spider_click",function(){e.marker_click(this)})):(e.markers[i].setMap(e.map),google.maps.event.addListener(e.markers[i],"click",function(){e.marker_click(this)}))}else e.center_map()},GMW_Map.prototype.center_map=function(){var o=this;if(0==o.zoom_position||o.auto_zoom_level)1==o.locations.length&&0==o.user_position?(o.auto_zoom_level?o.map.setZoom(13):o.map.setZoom(parseInt(o.options.zoom)),o.map.panTo(o.markers[0].getPosition())):o.auto_zoom_level||0==o.user_position?(o.auto_zoom_level||0==o.user_position)&&o.map.fitBounds(o.bounds):(o.map.setZoom(parseInt(o.options.zoom)),o.map.panTo(o.user_position));else{var e=new google.maps.LatLng(o.zoom_position,o.zoom_position);o.map.setZoom(parseInt(o.options.zoom)),o.map.panTo(e)}},GMW_Map.prototype.marker_click=function(o){GMW.do_action("gmw_map_marker_click",o,this),this.active_marker=o,"undefined"!=typeof directionsDisplay&&directionsDisplay.setMap(null),this.close_info_window();var e=this.info_window_type+"_info_window_init";"function"==typeof this[e]?this[e](o):console.log("The function "+e+" not exists.")},GMW_Map.prototype.close_info_window=function(){GMW.do_action("gmw_map_close_info_window",this.info_window_type,this);var o=this.info_window_type+"_info_window_close";"function"==typeof this[o]?this[o]():console.log("The function "+o+" not exists.")},GMW_Map.prototype.standard_info_window_close=function(){this.active_info_window&&(this.active_info_window.close(),this.active_info_window=null)},GMW_Map.prototype.standard_info_window_init=function(o){o.iw_content&&(this.active_info_window=new google.maps.InfoWindow({content:'<div class="gmw-info-window standard map-'+this.id+" "+this.prefix+'">'+o.iw_content+"</div>",maxWidth:200,minWidth:200}),this.active_info_window.open(this.map,o))},jQuery(document).ready(function(o){"undefined"!=typeof gmwMapObjects&&jQuery.each(gmwMapObjects,function(o,e){GMW_Maps[o]=new GMW_Map(e.settings,e.map_options,e.form),GMW_Maps[o].render(e.locations,e.user_location)})});