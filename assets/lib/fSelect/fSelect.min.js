!function(e){function t(e){var t=e.find(".fs-option:not(.fs-hidden)").length>0;e.find(".fs-no-results").toggleClass("fs-hidden",t)}function s(e){e.find(".fs-option.hl").removeClass("hl"),e.find(".fs-search input").focus(),window.fSelect.idx=-1}function n(e){var t=e.find(".fs-options"),s=e.find(".fs-option.hl"),i=s.offset().top+t.scrollTop(),n=i+s.outerHeight(),l=t.offset().top+t.scrollTop(),o=l+t.outerHeight();if(n>o){var a=t.scrollTop()+n-o;t.scrollTop(a)}else if(l>i){var a=t.scrollTop()-l-i;t.scrollTop(a)}}function l(i){window.fSelect.active_el=i,window.fSelect.active_id=i.data("id"),window.fSelect.initial_values=i.find("select").val(),e(document).trigger("fs:opened",i),i.find(".fs-dropdown").removeClass("fs-hidden"),i.addClass("fs-open"),s(i),t(i)}function o(t){if("undefined"==typeof t&&null!=window.fSelect.active_el&&(t=window.fSelect.active_el),"undefined"!=typeof t){var s=window.fSelect.initial_values,i=t.find("select").val();JSON.stringify(s)!=JSON.stringify(i)&&e(document).trigger("fs:closed",t)}e(".fs-wrap").removeClass("fs-open"),e(".fs-dropdown").addClass("fs-hidden"),window.fSelect.active_el=null,window.fSelect.active_id=null,window.fSelect.last_choice=null}String.prototype.unaccented=function(){for(var e=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],t=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],s=this,i=0;i<e.length;i++)s=s.replace(e[i],t[i]);return s},e.fn.fSelect=function(t){function s(t,s){this.$select=e(t),this.settings=s,this.create()}if("string"==typeof t)var i=t;else var i=e.extend({placeholder:"Select some options",numDisplayed:3,overflowText:"{n} selected",searchText:"Search",noResultsText:"No results found",showSearch:!0,optionFormatter:!1},t);return s.prototype={create:function(){this.idx=0,this.optgroup=0,this.selected=[].concat(this.$select.val()),this.settings.multiple=this.$select.is("[multiple]");var e="",t="",s=this.buildOptions(this.$select);this.settings.showSearch&&(e='<div class="fs-search"><input type="text" placeholder="'+this.settings.searchText+'" /></div>'),""!==this.settings.noResultsText&&(t='<div class="fs-no-results fs-hidden">'+this.settings.noResultsText+"</div>");var i='<div class="fs-label-wrap"><div class="fs-label"></div><span class="fs-arrow"></span></div>';i+='<div class="fs-dropdown fs-hidden">{search}{no-results}<div class="fs-options">'+s+"</div></div>",i=i.replace("{search}",e),i=i.replace("{no-results}",t),this.$select.wrap('<div class="fs-wrap'+(this.settings.multiple?" multiple":"")+'" tabindex="0" />'),this.$select.addClass("fs-hidden"),this.$select.before(i),this.$wrap=this.$select.closest(".fs-wrap"),this.$wrap.data("id",window.fSelect.num_items),window.fSelect.num_items++,this.reloadDropdownLabel()},reload:function(){this.destroy(),this.create()},destroy:function(){this.$wrap.find(".fs-label-wrap").remove(),this.$wrap.find(".fs-dropdown").remove(),this.$select.unwrap().removeClass("fs-hidden")},buildOptions:function(t){var s=this,i="";return t.children().each(function(t,n){var l=e(n);if("optgroup"==l.prop("nodeName").toLowerCase())i+='<div class="fs-optgroup-label" data-group="'+s.optgroup+'">'+l.prop("label")+"</div>",i+=s.buildOptions(l),s.optgroup++;else{var o=l.prop("value"),a=l.attr("class");if(a="undefined"!=typeof a?" "+a:"",0<s.idx||""!=o||!s.settings.multiple){var d=l.is(":disabled")?" disabled":"",f=-1<e.inArray(o,s.selected)?" selected":"",c=" g"+s.optgroup,r='<div class="fs-option'+f+d+c+a+'" data-value="'+o+'" data-index="'+s.idx+'"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">'+l.html()+"</div></div>";"function"==typeof s.settings.optionFormatter&&(r=s.settings.optionFormatter(r)),i+=r,s.idx++}}}),i},reloadDropdownLabel:function(){var t=this.settings,s=[];this.$wrap.find(".fs-option.selected").each(function(t,i){s.push(e(i).find(".fs-option-label").html())}),s=s.length<1?t.placeholder:s.length>t.numDisplayed?t.overflowText.replace("{n}",s.length):s.join(", "),this.$wrap.find(".fs-label").html(s),this.$wrap.toggleClass("fs-default",s===t.placeholder)}},this.each(function(){var t=e(this).data("fSelect");t||(t=new s(this,i),e(this).data("fSelect",t)),"string"==typeof i&&t[i]()})},window.fSelect={num_items:0,active_id:null,active_el:null,last_choice:null,idx:-1},e(document).on("click",".fs-option:not(.fs-hidden, .disabled)",function(t){var s=e(this).closest(".fs-wrap"),n=s.find("select"),l=!1;if(!s.hasClass("fs-disabled")){if(s.hasClass("multiple")){var a=[];if(t.shiftKey&&null!=window.fSelect.last_choice){var d=parseInt(e(this).attr("data-index")),f=!e(this).hasClass("selected"),c=Math.min(window.fSelect.last_choice,d),r=Math.max(window.fSelect.last_choice,d);for(i=c;i<=r;i++)s.find(".fs-option[data-index="+i+"]").not(".fs-hidden, .disabled").each(function(){e(this).toggleClass("selected",f)})}else window.fSelect.last_choice=parseInt(e(this).attr("data-index")),e(this).toggleClass("selected");s.find(".fs-option.selected").each(function(t,s){a.push(e(s).attr("data-value"))})}else{var a=e(this).attr("data-value");s.find(".fs-option").removeClass("selected"),e(this).addClass("selected"),l=!0}n.val(a),n.fSelect("reloadDropdownLabel"),n.change(),e(document).trigger("fs:changed",s),l&&o(s)}}),e(document).on("keyup",".fs-search input",function(i){if(40==i.which)return void e(this).blur();var n=e(this).closest(".fs-wrap"),l=/[|\\{}()[\]^$+*?.]/g,o=e(this).val().replace(l,"\\$&");n.find(".fs-option, .fs-optgroup-label").removeClass("fs-hidden"),""!=o&&(n.find(".fs-option").each(function(){var t=new RegExp(o.unaccented(),"gi"),s=e(this).find(".fs-option-label").text().unaccented();null===s.match(t)&&e(this).addClass("fs-hidden")}),n.find(".fs-optgroup-label").each(function(){var t=e(this).attr("data-group"),s=e(this).closest(".fs-options").find(".fs-option.g"+t+":not(.fs-hidden)").length;1>s&&e(this).addClass("fs-hidden")})),s(n),t(n)}),e(document).on("click",function(t){var s=e(t.target),i=s.closest(".fs-wrap");if(0<i.length){if(i.data("id")!==window.fSelect.active_id&&o(),s.hasClass("fs-label")||s.hasClass("fs-arrow")){var n=i.find(".fs-dropdown").hasClass("fs-hidden");n?l(i):o(i)}}else o()}),e(document).on("keydown",function(t){var s=window.fSelect.active_el,i=e(t.target);if(i.hasClass("fs-wrap")){if(32==t.which||13==t.which)return t.preventDefault(),void i.find(".fs-label").trigger("click")}else if(0<i.closest(".fs-search").length){if(32==t.which)return}else if(null===s)return;if(38==t.which){t.preventDefault(),s.find(".fs-option.hl").removeClass("hl");var l=s.find(".fs-option[data-index="+window.fSelect.idx+"]"),a=l.prevAll(".fs-option:not(.fs-hidden, .disabled)");a.length>0?(window.fSelect.idx=parseInt(a.attr("data-index")),s.find(".fs-option[data-index="+window.fSelect.idx+"]").addClass("hl"),n(s)):(window.fSelect.idx=-1,s.find(".fs-search input").focus())}else if(40==t.which){t.preventDefault();var l=s.find(".fs-option[data-index="+window.fSelect.idx+"]");if(l.length<1)var d=s.find(".fs-option:not(.fs-hidden, .disabled):first");else var d=l.nextAll(".fs-option:not(.fs-hidden, .disabled)");d.length>0&&(window.fSelect.idx=parseInt(d.attr("data-index")),s.find(".fs-option.hl").removeClass("hl"),s.find(".fs-option[data-index="+window.fSelect.idx+"]").addClass("hl"),n(s))}else 32==t.which||13==t.which?(t.preventDefault(),s.find(".fs-option.hl").click()):27==t.which&&o(s)})}(jQuery);