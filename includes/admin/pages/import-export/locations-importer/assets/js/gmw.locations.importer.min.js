jQuery(document).ready(function(o){var t={processing:!1,form:!1,import_details:!1,updated_ph:!1,imported_ph:!1,existing_ph:!1,updated_ph:!1,failed_ph:!1,action_ph:!1,importer:{},init:function(){o("body").on("submit",".gmw-locations-importer",function(e){e.preventDefault(),o(".gmw-locations-importer-submit").attr("disabled","disabled"),t.form=o(this),t.processing?alert("There is already another importer running. Please wait for the current importer to finish before starting another one."):(t.form.find(".gmw-importer-details").remove(),t.form.append(t.form.closest("div.gmw-locations-importer-wrapper").find(".gmw-importer-details").clone()),t.import_details=t.form.find(".gmw-importer-details"),t.import_details.fadeIn("300",function(){t.action_ph=t.import_details.find(".action-ph"),t.updated_ph=t.import_details.find(".updated-ph"),t.imported_ph=t.import_details.find(".imported-ph"),t.existing_ph=t.import_details.find(".existing-ph"),t.failed_ph=t.import_details.find(".failed-ph"),importAction=t.form.find(".gmw_locations_importer_action").val(),t.import_data(importAction,0,0,0,0,0,0,0)}))}),this.abort()},import_data:function(e,i,r,a,n,s,d,m){t.processing=!0,t.form.find(".gmw-locations-importer-abort").fadeIn("300"),nonce=t.form.find(".gmw_locations_importer_nonce").val();var p=t.form.serialize();t.importer=o.ajax({type:"POST",url:gmwVars.ajaxUrl,dataType:"json",data:{action:"gmw_locations_importer",formData:p,importAction:e,recordsCompleted:i,locationsUpdated:r,locationsImported:a,locationsExist:n,locationsFailed:s,totalLocations:d,batchNumber:0,security:nonce},success:function(i){t.action_ph.html("Importing..."),t.form.find(".completed-ph").html(i.records_completed),t.form.find(".total-ph").html(i.total_locations),t.updated_ph.html(i.locations_updated),t.imported_ph.html(i.locations_imported),t.existing_ph.html(i.locations_exist),t.failed_ph.html(i.locations_failed),i.done?(0==i.total_locations?(t.action_ph.html("No locations were found!"),recordsFound=!1):(t.form.find(".gmw-importer-progress-bar div").removeClass("importing").addClass("completed"),t.action_ph.html("Importing Completed!"),recordsFound=!0),t.form.find(".gmw-importer-spinner").hide(),t.processing=!1,o(".gmw-locations-importer-submit").removeAttr("disabled"),t.form.find(".gmw-locations-importer-abort").fadeOut("300"),o(".gmw-importer-details .done-message").fadeIn(),o.ajax({type:"POST",url:gmwVars.ajaxUrl,dataType:"json",data:{action:"gmw_locations_importer_done",formData:p,importAction:e,recordsFound:recordsFound,recordsCompleted:i.records_completed,locationsUpdated:i.locations_updated,locationsImported:i.locations_imported,locationsExist:i.locations_exist,locationsFailed:i.locations_failed,totalLocations:i.total_locations,security:nonce}})):t.import_data(e,parseInt(i.records_completed),parseInt(i.locations_updated),parseInt(i.locations_imported),parseInt(i.locations_exist),parseInt(i.locations_failed),parseInt(i.total_locations),parseInt(i.batch_number)),t.form.find(".gmw-importer-progress-bar div").animate({width:i.percentage+"%"},50)}}).fail(function(e){window.console&&window.console.log&&(e.responseText&&console.log(e.responseText),console.log(e)),"undefined"!=e.statusText&&"abort"==e.statusText?message="Import canceled!":message="The importer could not proceed due to an error.",t.action_ph.addClass("error"),t.action_ph.html(message),t.form.find(".gmw-importer-spinner").hide(),t.processing=!1,o(".gmw-locations-importer-submit").removeAttr("disabled"),t.form.find(".gmw-locations-importer-abort").fadeOut("300")}),t.importer.done(function(o){console.log(o.log)})},abort:function(){o(document).on("click",".gmw-locations-importer-abort",function(){confirm("Are you sure? ")&&t.importer.abort()})}};t.init()});